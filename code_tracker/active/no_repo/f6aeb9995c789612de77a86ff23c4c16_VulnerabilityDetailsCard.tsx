§?
import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card";
import { Badge } from "@/components/ui/badge";
import { ScrollArea } from "@/components/ui/scroll-area";
import { Calendar, AlertTriangle, ExternalLink, Package, Shield } from "lucide-react";
import { cn } from "@/lib/utils";

interface VulnerabilityDetailsCardProps {
    vulnerability: any;
    className?: string;
}

export function VulnerabilityDetailsCard({ vulnerability, className }: VulnerabilityDetailsCardProps) {
    if (!vulnerability) return null;

    const formatDate = (dateString?: string | { $date: string }) => {
        if (!dateString) return "N/A";
        // Handle MongoDB style date object
        const dateStr = typeof dateString === 'object' && '$date' in dateString ? dateString.$date : dateString;
        try {
            return new Date(dateStr).toLocaleDateString(undefined, {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
        } catch (e) {
            return "Invalid Date";
        }
    };

    return (
        <Card className={cn("border-l-4 border-l-primary/50 overflow-hidden", className)}>
            <CardHeader className="pb-3 bg-muted/20">
                <div className="flex items-start justify-between">
                    <div className="space-y-1">
                        <div className="flex items-center gap-2">
                            <CardTitle className="text-lg font-bold flex items-center gap-2">
                                <Shield className="h-5 w-5 text-primary" />
                                {vulnerability.id}
                            </CardTitle>
                            {vulnerability.aliases?.map((alias: string) => (
                                <Badge key={alias} variant="outline" className="text-xs">
                                    {alias}
                                </Badge>
                            ))}
                        </div>
                        {vulnerability.summary && (
                            <p className="text-sm font-medium text-foreground/80">{vulnerability.summary}</p>
                        )}
                    </div>
                    {vulnerability.severity?.cvss_v3_score && (
                        <div className="flex flex-col items-end">
                            <Badge variant={
                                (vulnerability.severity?.cvss_v3_score || 0) >= 9.0 ? "destructive" :
                                    (vulnerability.severity?.cvss_v3_score || 0) >= 7.0 ? "destructive" :
                                        (vulnerability.severity?.cvss_v3_score || 0) >= 4.0 ? "secondary" : "outline"
                            } className="text-sm px-2 py-1">
                                CVSS {vulnerability.severity.cvss_v3_score}
                            </Badge>
                            <span className="text-xs text-muted-foreground capitalize mt-1">
                                {vulnerability.severity.cvss_v3_severity?.toLowerCase() || "Unknown"}
                            </span>
                        </div>
                    )}
                </div>
            </CardHeader>
            <CardContent className="grid gap-6 pt-6 text-sm">

                {/* Details Section */}
                <div className="space-y-2">
                    <h4 className="font-semibold flex items-center gap-2 text-foreground">
                        <AlertTriangle className="h-4 w-4 text-muted-foreground" />
                        Details
                    </h4>
                    <ScrollArea className="h-[100px] w-full rounded-md border p-3 bg-muted/10 text-muted-foreground">
                        {vulnerability.details || "No details provided."}
                    </ScrollArea>
                </div>

                {/* Dates & Metadata Grid */}
                <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
                    <div className="space-y-1">
                        <span className="text-xs text-muted-foreground flex items-center gap-1">
                            <Calendar className="h-3 w-3" /> Published
                        </span>
                        <p className="font-medium">{formatDate(vulnerability.published)}</p>
                    </div>
                    <div className="space-y-1">
                        <span className="text-xs text-muted-foreground flex items-center gap-1">
                            <Calendar className="h-3 w-3" /> Modified
                        </span>
                        <p className="font-medium">{formatDate(vulnerability.modified)}</p>
                    </div>
                    <div className="space-y-1">
                        <span className="text-xs text-muted-foreground flex items-center gap-1">
                            <Calendar className="h-3 w-3" /> Withdrawn
                        </span>
                        <p className={cn("font-medium", vulnerability.withdrawn ? "text-destructive" : "")}>
                            {vulnerability.withdrawn ? formatDate(vulnerability.withdrawn) : "Active"}
                        </p>
                    </div>
                </div>

                {/* Affected Packages */}
                {vulnerability.affected && vulnerability.affected.length > 0 && (
                    <div className="space-y-2">
                        <h4 className="font-semibold flex items-center gap-2 text-foreground">
                            <Package className="h-4 w-4 text-muted-foreground" />
                            Affected Packages
                        </h4>
                        <div className="flex flex-wrap gap-2">
                            {vulnerability.affected.map((item: any, idx: number) => (
                                <Badge key={idx} variant="secondary" className="font-mono text-xs">
                                    {item.package?.ecosystem || item.ecosystem}: {item.package?.name || item.package}
                                    {item.versions && item.versions.length > 0 &&
                                        <span className="ml-1 opacity-70">({item.versions.length} versions)</span>
                                    }
                                </Badge>
                            ))}
                        </div>
                    </div>
                )}

                {/* References */}
                {vulnerability.references && vulnerability.references.length > 0 && (
                    <div className="space-y-2">
                        <h4 className="font-semibold flex items-center gap-2 text-foreground">
                            <ExternalLink className="h-4 w-4 text-muted-foreground" />
                            References
                        </h4>
                        <div className="grid grid-cols-1 gap-1">
                            {vulnerability.references.slice(0, 3).map((ref: any, idx: number) => (
                                <a
                                    key={idx}
                                    href={ref.url}
                                    target="_blank"
                                    rel="noopener noreferrer"
                                    className="text-xs text-primary hover:underline truncate block"
                                >
                                    {ref.url}
                                </a>
                            ))}
                            {vulnerability.references.length > 3 && (
                                <span className="text-xs text-muted-foreground italic">
                                    + {vulnerability.references.length - 3} more references
                                </span>
                            )}
                        </div>
                    </div>
                )}
            </CardContent>
        </Card>
    );
}
§?2Qfile:///c:/SCOUTNEW/scout_db/frontend/src/components/VulnerabilityDetailsCard.tsx