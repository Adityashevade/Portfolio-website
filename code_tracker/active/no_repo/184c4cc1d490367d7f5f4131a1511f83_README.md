“K# Scout Registry

A self-populating package metadata catalog that aggregates package information from all major package registries into a unified MongoDB + S3 storage system.

## Overview

Scout Registry implements a **fetch-on-demand** pattern:
1. When a package is requested, check MongoDB first
2. If not found, fetch from the upstream registry
3. Store in MongoDB (queryable fields) + S3 (extended data)
4. Return the data

This approach means the database populates itself as packages are queried, with no need for bulk synchronization.

## Supported Ecosystems

| Ecosystem | Registry | Package Format | Status |
|-----------|----------|----------------|--------|
| npm | registry.npmjs.org | `package-name` | ‚úÖ Full support |
| PyPI | pypi.org | `package-name` | ‚úÖ Full support |
| Cargo | crates.io | `crate-name` | ‚úÖ Full support |
| RubyGems | rubygems.org | `gem-name` | ‚úÖ Full support |
| Packagist | packagist.org | `vendor/package` | ‚úÖ Full support |
| Hex | hex.pm | `package-name` | ‚úÖ Full support |
| Maven | search.maven.org | `groupId:artifactId` | ‚úÖ Basic support |
| NuGet | nuget.org | `PackageId` | ‚úÖ Full support |
| Go | proxy.golang.org | `github.com/org/repo` | ‚ö†Ô∏è Limited metadata |

## API Endpoints

Base URL: `http://localhost:8001/api/v1`

### Generic Endpoints (most ecosystems)

```
GET  /{ecosystem}/{name}                    # Package summary
GET  /{ecosystem}/{name}/versions           # All versions
GET  /{ecosystem}/{name}/{version}          # Version details (MongoDB)
GET  /{ecosystem}/{name}/{version}/full     # Version + S3 extended data
GET  /{ecosystem}/{name}/{version}/normalized  # Cross-ecosystem normalized format
POST /{ecosystem}/{name}/refresh            # Force refresh from registry
POST /{ecosystem}/{name}/{version}/source   # Download source to S3
GET  /{ecosystem}/{name}/{version}/source   # Check source status in S3
```

### Special URL Formats

**Packagist** (vendor/package):
```
GET  /packagist/{vendor}/{package}
GET  /packagist/{vendor}/{package}/{version}
# Example: /packagist/symfony/console/v6.0.0
```

**Maven** (groupId:artifactId via path):
```
GET  /maven/{groupId}/{artifactId}
GET  /maven/{groupId}/{artifactId}/{version}
# Example: /maven/org.apache.logging.log4j/log4j-core/2.17.0
```

**Go** (module paths with @v for version):
```
GET  /go/{module_path}
GET  /go/{module_path}/@v/{version}
# Example: /go/github.com/gin-gonic/gin/@v/v1.9.0
```

### Utility Endpoints

```
GET  /packages                              # Search packages
GET  /packages/bulk?packages=eco:name:ver   # Bulk lookup
GET  /stats                                 # Database statistics
```

## Data Storage

### MongoDB Collections

- **`_packages`**: Package summaries (one per package)
- **`npm`**, **`pypi`**, **`cargo`**, etc.: Version documents (one per ecosystem)

### S3 Storage

- **`{ecosystem}/{name}/{version}.json`**: Extended metadata
- **`sourceFiles/{ecosystem}/{name}/{version}.tgz`**: Source archives

## Ecosystem Details

### npm
- **Source**: registry.npmjs.org
- **Metadata**: Complete (license, dependencies, maintainers, checksums)
- **Source Download**: Tarball from `dist.tarball`
- **Gaps**: None

### PyPI
- **Source**: pypi.org/pypi
- **Metadata**: Complete (license, dependencies, maintainers, checksums)
- **Source Download**: sdist from `release_files`
- **Gaps**: Only downloads sdist, not wheel files

### Cargo (Rust)
- **Source**: crates.io/api/v1/crates
- **Metadata**: Complete (license, dependencies, features, MSRV)
- **Source Download**: Crate tarball via `dl_path`
- **Rate Limit**: 1 second (crates.io is strict)
- **Gaps**: None

### RubyGems
- **Source**: rubygems.org/api/v1
- **Metadata**: Complete (license, dependencies, maintainers)
- **Source Download**: Gem file via `gem_uri`
- **Gaps**: None

### Packagist (PHP)
- **Source**: repo.packagist.org/p2
- **Metadata**: Complete (license, dependencies, authors)
- **Source Download**: Archive via `dist.url`
- **URL Format**: Requires `vendor/package` format
- **Gaps**: None

### Hex (Elixir/Erlang)
- **Source**: hex.pm/api
- **Metadata**: Complete (license, dependencies, maintainers)
- **Source Download**: `https://repo.hex.pm/tarballs/{name}-{version}.tar`
- **Gaps**: None

### Maven (Java)
- **Source**: search.maven.org (Solr search API)
- **Metadata**: Basic (version list, timestamps, packaging type)
- **Source Download**: JAR from repo1.maven.org
- **URL Format**: `groupId:artifactId` internally, `groupId/artifactId` in URLs
- **Gaps**:
  - License, description, developers require POM parsing (not implemented)
  - Dependencies require POM parsing
  - POM fetch method exists (`_fetch_pom`, `_parse_pom`) but not called during fetch

### NuGet (.NET)
- **Source**: api.nuget.org/v3 (Registration API)
- **Metadata**: Complete (license, dependencies, target frameworks)
- **Source Download**: nupkg from flat container API
- **Pagination**: Handles paginated registration for large packages
- **Gaps**:
  - Packages with many versions (e.g., Serilog: 589 versions) take 30-60 seconds
  - Fetches all pages sequentially

### Go
- **Source**: proxy.golang.org
- **Metadata**: Limited (version list, timestamps only)
- **Source Download**: Module zip from proxy
- **URL Format**: Full module path (e.g., `github.com/gin-gonic/gin`)
- **Encoding**: Uppercase letters encoded as `!lowercase` (e.g., `GitHub` ‚Üí `!git!hub`)
- **Gaps**:
  - **No license info** (proxy doesn't provide it)
  - **No dependencies** (would need to fetch and parse go.mod)
  - **No description** (would need to scrape pkg.go.dev)
  - Repository URL inferred from module path (github.com, gitlab.com, bitbucket.org)

## Normalized Format

All ecosystems can return a normalized format for cross-ecosystem queries:

```json
{
  "ecosystem": "npm",
  "name": "lodash",
  "version": "4.17.21",
  "license": {
    "spdx": "MIT",
    "name": null,
    "source": "package.json"
  },
  "release_date": "2021-02-20T15:42:16.891Z",
  "status": {
    "deprecated": false,
    "yanked": false,
    "prerelease": false,
    "deprecated_message": null
  },
  "maintainers": [{"name": "jdalton", "email": "...", "url": null}],
  "author": {"name": "John-David Dalton", "email": "...", "url": "..."},
  "dependencies": {
    "runtime": [{"name": "...", "constraint": "^1.0.0", "ecosystem": "npm", "optional": false}],
    "development": [],
    "optional": [],
    "build": [],
    "peer": []
  },
  "links": {
    "repository": "https://github.com/lodash/lodash",
    "homepage": "https://lodash.com/",
    "documentation": null,
    "changelog": null,
    "issues": "https://github.com/lodash/lodash/issues"
  },
  "checksums": {"sha512": "..."},
  "size_bytes": 123456,
  "keywords": ["modules", "stdlib", "util"],
  "description": "Lodash modular utilities."
}
```

## Configuration

Environment variables (prefix: `SCOUT_REGISTRY_`):

```bash
# MongoDB
SCOUT_REGISTRY_MONGODB_URI=mongodb://localhost:27017
SCOUT_REGISTRY_MONGODB_DATABASE=scout_registry

# S3
SCOUT_REGISTRY_S3_BUCKET=scout-registry-sandbox
SCOUT_REGISTRY_S3_REGION=ap-south-1

# Rate limits (seconds between requests)
SCOUT_REGISTRY_NPM_RATE_LIMIT=0.1
SCOUT_REGISTRY_PYPI_RATE_LIMIT=0.1
SCOUT_REGISTRY_CARGO_RATE_LIMIT=1.0  # crates.io is strict
SCOUT_REGISTRY_MAVEN_RATE_LIMIT=0.5
SCOUT_REGISTRY_GO_RATE_LIMIT=0.1
SCOUT_REGISTRY_RUBYGEMS_RATE_LIMIT=0.1
SCOUT_REGISTRY_NUGET_RATE_LIMIT=0.1
SCOUT_REGISTRY_PACKAGIST_RATE_LIMIT=0.1
SCOUT_REGISTRY_HEX_RATE_LIMIT=0.1

# API Server
SCOUT_REGISTRY_API_HOST=0.0.0.0
SCOUT_REGISTRY_API_PORT=8001
```

## Running

```bash
# Start the API server
poetry run scout-registry

# Server runs on http://localhost:8001
# API docs at http://localhost:8001/docs
```

## Architecture

```
src/scout_registry/
‚îú‚îÄ‚îÄ api/
‚îÇ   ‚îî‚îÄ‚îÄ routes.py           # FastAPI endpoints
‚îú‚îÄ‚îÄ db/
‚îÇ   ‚îî‚îÄ‚îÄ connection.py       # MongoDB connection + indexes
‚îú‚îÄ‚îÄ models/
‚îÇ   ‚îú‚îÄ‚îÄ base.py             # Base Pydantic model
‚îÇ   ‚îú‚îÄ‚îÄ normalized.py       # Cross-ecosystem normalized model
‚îÇ   ‚îú‚îÄ‚îÄ summary.py          # Package summary model
‚îÇ   ‚îî‚îÄ‚îÄ {ecosystem}.py      # Ecosystem-specific models
‚îú‚îÄ‚îÄ normalizers/
‚îÇ   ‚îú‚îÄ‚îÄ base.py             # Base normalizer with helpers
‚îÇ   ‚îî‚îÄ‚îÄ {ecosystem}.py      # Ecosystem-specific normalizers
‚îú‚îÄ‚îÄ registries/
‚îÇ   ‚îú‚îÄ‚îÄ base.py             # Base adapter with fetch_and_store
‚îÇ   ‚îî‚îÄ‚îÄ {ecosystem}.py      # Ecosystem-specific adapters
‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îî‚îÄ‚îÄ package_service.py  # Main business logic
‚îú‚îÄ‚îÄ storage/
‚îÇ   ‚îî‚îÄ‚îÄ s3.py               # S3 storage operations
‚îú‚îÄ‚îÄ config.py               # Settings from environment
‚îî‚îÄ‚îÄ main.py                 # FastAPI app entry point
```

## Future Improvements

### High Priority
1. **Go metadata enrichment**: Fetch go.mod for dependencies, scrape pkg.go.dev for license/description
2. **Maven POM parsing**: Call existing `_fetch_pom`/`_parse_pom` during fetch for full metadata
3. **NuGet parallel page fetch**: Fetch paginated pages concurrently instead of sequentially

### Medium Priority
4. **Checksum verification**: Verify downloaded sources against registry checksums
5. **PyPI wheel support**: Option to download wheel files instead of/in addition to sdist
6. **Caching layer**: Redis cache for frequently accessed packages
7. **Background refresh**: Periodic refresh of stale packages

### Low Priority
8. **Additional ecosystems**: CocoaPods, pub.dev (Dart), Hackage (Haskell)
9. **Vulnerability correlation**: Link to scout_db vulnerability data
10. **Download statistics**: Track and expose download counts where available
“K29file:///c:/SCOUTNEW/scout_db/src/scout_registry/README.md