Å
from fastapi import APIRouter, Query, HTTPException
from typing import List, Optional, Dict, Any
from scout_db.services.vulnerability_db import vulnerability_db, DB_PATH

router = APIRouter(
    prefix="/api/v1/vulnerabilities",
    tags=["vulnerabilities"],
    responses={404: {"description": "Not found"}},
)

@router.get("/search")
async def search_vulnerabilities(q: str = Query(..., min_length=2), limit: int = 10) -> List[Dict[str, Any]]:
    """
    Search for vulnerabilities by ID, CVE, or Package Name.
    Max limit is 15 to prevent UI freezing.
    """
    if limit > 15:
        limit = 15
    results = vulnerability_db.search(q, limit)
    return results

@router.get("/{vuln_id}")
async def get_vulnerability(vuln_id: str) -> Dict[str, Any]:
    """
    Get a single vulnerability by ID (GHSA-... or CVE-...).
    """
    if vuln_id == "status":
        # Special 'status' endpoint to check DB state
        return {
            "loaded": vulnerability_db._loaded,
            "count": len(vulnerability_db._data),
            "error": vulnerability_db._error,
            "path": str(DB_PATH) if DB_PATH else "None"
        }

    result = vulnerability_db.get_by_id(vuln_id)
    if not result:
        raise HTTPException(status_code=404, detail="Vulnerability not found")
    return result
¢ *cascade08¢«*cascade08«Ò *cascade08ÒÓ*cascade08ÓÔ *cascade08Ô×*cascade08×ç*cascade08ç” *cascade08”Á*cascade08ÁÄ *cascade08Äì*cascade08ìá *cascade08á 	*cascade08 	Å
 *cascade082Efile:///C:/SCOUTNEW/scout_db/src/scout_db/api/vulnerability_routes.py