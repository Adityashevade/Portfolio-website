# Walkthrough: Unified API and Fixed Data Formats

I have resolved the network errors and UI loading issues by unifying the backend services and correcting data format discrepancies.

## Changes Made

### Backend Unification
- Integrated `scout_registry` routes into the main `scout_db` backend.
- Both `scout_db` and `scout_registry` MongoDB connections are now established during the application lifespan.
- All package-related APIs are now accessible on the same port (8000) as the vulnerability APIs, matching the frontend's configuration.

### Data Format Correction
- Updated the following endpoints to return a paginated object `{ "items": [...], "total": ... }` instead of a raw list:
    - `GET /api/v1/aliases`
    - `GET /api/v1/overrides`
    - `GET /api/v1/audit`
    - `GET /api/v1/vulnerabilities`
    - `GET /api/v1/kev`
- This ensures that UI components (like the Dashboard counters and DataTables) can correctly parse the response data.

### Connectivity and Proxy
- Updated [frontend/src/lib/api.ts](file:///c:/SCOUTNEW/scout_db/frontend/src/lib/api.ts) to use a relative `baseURL` (`/api/v1`).
- This ensures the frontend correctly uses the Vite proxy defined in [vite.config.ts](file:///c:/SCOUTNEW/scout_db/frontend/vite.config.ts), avoiding CORS issues and ensuring a stable connection to the backend.

### Final Verification Results

- **Backend Health**: Verified `http://127.0.0.1:8000/health` returns 200.
- **Data Loading**: Verified `GET /api/v1/aliases` returns the correct `{ items, total }` format.
- **Frontend Compatibility**: Confirmed that Dashboard, Aliases, and Audit Log pages are all using the unified `api` instance and handling the new data format.

## Unified Startup (Recommended)

I have implemented a **bulletproof startup script** [scout_start.ps1](file:///c:/SCOUTNEW/scout_start.ps1) that fixes the "spawn cmd.exe ENOENT" error by ensuring the correct system paths are set.

**To start everything properly, run:**
```powershell
npm run dev:full
```

## Troubleshooting

> [!IMPORTANT]
> - **500 Error in UI**: This usually means the backend is not running or the database connection is timing out. The new `dev:full` script ensures both are connected.
> - **ECONNREFUSED**: This means the backend is not listening. Running `npm run dev:full` will start it on port 8000 automatically.
